<div class="clearfix">
    <div class="pull-left ctd-topcontrols" id="timeline">

        @*<div class="clearfix mbm">*@
        <span class="display-inline bold mrm mbm">[|Activities|]</span>
        <span class="select display-inline mbm">
            <select class="cu-multiselect" data-bind="kendoMultiSelect:{ data : Activities, value: ActivityIDS, dataValueField: 'ActivityID', dataTextField: 'ActivityValue',multiple:'multiple' }"></select>
        </span>
        @*</div>*@

        <span class="display-inline mhm bold mbm">[|Period|]</span>
        <span class="select display-inline mrm mbm" id="daterangecustom">
            <input data-bind="kendoDropDownList: { dataTextField: 'PeriodRangeValue', dataValueField: 'PeriodRangeID', data: PeriodRanges, value: Period, change:periodChange, optionLabel: 'Select time period' }" />
        </span>
        <span class="display-inline mbm" data-bind="visible:CustomDateDisplay">
            <span class="mrm">[|From|] </span>
            <span class="input-block display-inline form-group mbn">
                <span class="input-group">
                    <input data-bind="kendoDatePicker: { value: CustomStartDate, max: fromMaxDate,format:DateFormat,change: fromDateChangeEvent }" />
                </span>
            </span>
            <span class="mhm">[|To|] </span>
            <span class="input-block display-inline form-group mbn">
                <span class="input-group">
                    <input data-bind="kendoDatePicker: { value: CustomEndDate, max: toMaxDate,format:DateFormat,change: toDateChangeEvent }" />
                </span>
            </span>
        </span>
    </div>
</div>
<section class="cd-timeline cd-container" data-bind="groupby: { group: TimeLineData(),by: function (ele) { return ele.Year; },sort: 'descending'}">
    <div>
        @*year displays*@
        <div class="cd-timeline-year">
            <a href="javascript:void(0)">
                <span data-bind="text: $data[0].Year"></span> <span data-bind="text: $parents[0].GetFullYearLength($data[0].Year)"></span>
                <span data-bind="text: $data.length == 1?' Activity':' Activities'"></span>
            </a>
        </div>
        </br>
        <div data-bind="groupby: { group: $data,by: function (inrele) { return inrele.SortBy; },sort: 'descending'}">
            <div class="clearfix">
                <div class="cd-timeline-month">
                    <a href="javascript:void(0)">
                        <span data-bind="text: $data[0].MonthName"></span> -
                        <span data-bind="text:$parents[1].GetFullLength($data[0].Year,$data[0].Month)"></span>
                        <span data-bind="text: $data.length == 1?' Activity':' Activities'"></span>
                    </a>
                </div>
                <div data-bind="foreach: $data">
                    <div class="cd-timeline-block">

                        <div class="cd-timeline-img cd-notes" data-bind="visible:Module === 'Note'">
                            <i class="icon st-icon-book-lines"></i>
                        </div>
                        <div class="cd-timeline-img cd-tours" data-bind="visible:Module === 'Tour'">
                            <i class="icon st-icon-pin-2"></i>
                        </div>
                        <div class="cd-timeline-img cd-actions" data-bind="visible:Module === 'Action'">
                            <i class="icon st-icon-tick"></i>
                        </div>
                        <div class="cd-timeline-img cd-contact" data-bind="visible:Module === 'Contact'">
                            <i class="icon st-icon-users"></i>
                        </div>
                        <div class="cd-timeline-img cd-relationship" data-bind="visible:Module === 'Relationship'">
                            <i class="icon st-icon-support-3"></i>
                        </div>
                        <div class="cd-timeline-img cd-emails" data-bind="visible:Module === 'Email'">
                            <i class="icon st-icon-envelope"></i>
                        </div>
                        <div class="cd-timeline-img cd-emails" data-bind="visible:Module === 'Email Received'">
                            <i class="icon st-icon-envelope"></i>
                        </div>
                        <div class="cd-timeline-img cd-form-submissions" data-bind="visible:Module === 'Form'">
                            <i class="icon st-icon-paragraph-justify-2"></i>
                        </div>
                        <div class="cd-timeline-img cd-campaigns" data-bind="visible:Module === 'Campaign'">
                            <i class="icon st-icon-bullhorn-2"></i>
                        </div>
                        <div class="cd-timeline-img cd-emails" data-bind="visible:Module === 'Text'">
                            <i class="icon st-icon-speech-bubble-center-2"></i>
                        </div>
                        <div class="cd-timeline-img cd-opportunity" data-bind="visible:Module === 'Opportunity'">
                            <i class="icon st-icon-opputunities"></i>
                        </div>
                        <div class="cd-timeline-img cd-attachments" data-bind="visible:Module === 'Attachment'">
                            <i class="icon st-icon-attachment"></i>
                        </div>
                        <div class="cd-timeline-img cd-attachments" data-bind="visible:Module === 'Lifecycle'">
                            <i class="icon st-icon-spool"></i>
                        </div>
                        <div class="cd-timeline-img cd-web-visits" data-bind="visible:Module === 'Web Visit'">
                            <i class="icon st-icon-website"></i>
                        </div>
                        <div class="cd-timeline-img cd-lead-adapter" data-bind="visible:Module === 'Lead Adapter'">
                            <i class="icon st-icon-polaroid-2"></i>
                        </div>
                        <div class="cd-timeline-content">
                            <h2>
                                <span data-bind="text: Module"></span> <span data-bind="text:AuditAction"></span>
                                <!-- ko if : Value.substring(Value.length-3) === '|1|'-->
                                <span class="icon st-icon-notes" style="padding-left: 5px;" title="Added to Contact Summary"></span>
                                <!--/ko-->
                            </h2>
                            <p class="tm-minimize" data-bind="visible:Module === 'Attachment'">
                                <i class='icon st-icon-image' data-bind="visible:$parents[2].GetAttachmentAttributes(Value, 'icon') == '1'"></i>
                                <i class='icon st-icon-pdf' data-bind="visible:$parents[2].GetAttachmentAttributes(Value, 'icon') == '2'"></i>
                                <i class="icon st-icon-word" data-bind="visible:$parents[2].GetAttachmentAttributes(Value, 'icon') == '3'"></i>
                                <i class="icon st-icon-excel" data-bind="visible:$parents[2].GetAttachmentAttributes(Value, 'icon') == '4'"></i>
                                <i class="icon st-icon-csv" data-bind="visible:$parents[2].GetAttachmentAttributes(Value, 'icon') == '5'"></i>
                                <i class="icon st-icon-txt" data-bind="visible:$parents[2].GetAttachmentAttributes(Value, 'icon') == '6'"></i>
                                <i class="icon st-icon-rtf" data-bind="visible:$parents[2].GetAttachmentAttributes(Value, 'icon') == '7'"></i>
                                <i class="icon st-icon-document" data-bind="visible:$parents[2].GetAttachmentAttributes(Value, 'icon') == '8'"></i>
                                <a data-bind="text:$parents[2].GetName(Value),attr: { href: $parents[2].GetUrl(Value)}" target="_new"></a>
                            </p>
                            <p data-bind="visible:Module !== 'Attachment' && Module !== 'Note' , text:Value,attr: {'class': (Module === 'Web Visit') ? 'web-visits tm-minimize':'tm-minimize' }"></p>
                            <p data-bind="visible:Module !== 'Attachment' && Module === 'Note', text:Value.substring(0,Value.length-3),attr: {'class': (Module === 'Web Visit') ? 'web-visits tm-minimize':'tm-minimize' }"></p>
                            

                            <span class="cd-controls">
                                <!-- ko if : AuditStatus === true-->
                                <span data-bind="visible:Module === 'Note' ">                                   
                                    <a data-target="#modal" data-toggle="modal" data-bind="attr:{href: '/Contact/EditNote?noteId=' + ModuleId }" class='mll'><i class='icon st-icon-edit'></i></a>
                                    <a href='javascript:void(0)' data-bind="click: function(){ $parents[2].DeleteNote(ModuleId) }" class='mlm'><i class='icon st-icon-bin-3'></i></a>
                                </span>
                                <span data-bind="visible:Module === 'Tour'">
                                    <a data-target="#modal" data-toggle="modal" data-bind="attr:{href: '/Contact/EditTour?tourId=' + ModuleId }" class='mll'><i class='icon st-icon-edit'></i></a>
                                    <a href='javascript:void(0)' data-bind="click: function(){ $parents[2].DeleteTour(ModuleId) }" class='mlm'><i class='icon st-icon-bin-3'></i></a>
                                </span>
                                <span data-bind="visible:Module === 'Action'">
                                    <a data-target="#modal" data-toggle="modal" data-bind="attr:{href: '/editaction?actionId=' + ModuleId }" class='mll'><i class='icon st-icon-edit'></i></a>
                                    <a data-toggle="modal" data-target="#modal" class='mlm'
                                       data-bind="attr: { 'href': '@Url.Action("GetActionContactsCount", "Contact")?actionId=' +ModuleId+'&contactId='+ContactID }">
                                        <i class="icon st-icon-bin-3"></i>
                                    </a>
                                </span>
                                <span data-bind="visible:Module === 'Relationship' ">
                                    <a data-target="#modal" data-toggle="modal" data-bind="attr:{href: '/Contact/EditRelation?contactRelationshipMapID=' + ModuleId }" class='mll'><i class='icon st-icon-edit'></i></a>
                                    <a href='javascript:void(0)' data-bind="click: function(){ $parents[2].DeleteRelationship(ModuleId) }" class='mlm'><i class='icon st-icon-bin-3'></i></a>
                                </span>
                                <a data-target="#modal" data-toggle="modal" data-bind="visible:Module === 'Form' && !IsAPIForm, attr:{href: '/formsubmissioninfo?FormSubmissionID=' + ModuleId }" title="View" class='mll'>
                                    <i class='icon st-icon-eye notifiy-view'></i>
                                </a>
                                <!--ko if: Module === "Lead Adapter" -->
                                <a data-target="#bigmodal" data-toggle="modal" data-bind="attr:{href: '/leadadaptersubmission?JobLogDetailID=' + ModuleId }" title="View" class='mll'>
                                    <i class='icon st-icon-eye notifiy-view'></i>
                                </a>
                                <!--/ko-->
                                <!--ko if: Module === 'Email' -->
                                <a data-target="#bigmodal" data-toggle="modal" data-bind="attr:{href: '/getemailbody?SendMailDetailID=' + ModuleId }" title="View" class='mll'>
                                    <i class='icon st-icon-eye notifiy-view'></i>
                                </a>
                                <!--/ko-->
                                <!--ko if: Module === 'Email Received' -->
                                <a data-target="#bigmodal" data-toggle="modal" data-bind="attr:{href: '/getreceivedemailbody?ReceivedMailInfoID=' + ModuleId }" title="View" class='mll'>
                                    <i class='icon st-icon-eye notifiy-view'></i>
                                </a>
                                <!--/ko-->
                                <!--ko if: Module === 'Campaign' -->
                                <a  data-bind="attr:{'data-id': ModuleId }" title="View" class='mll' onclick="ViewCampaign(this)">
                                    <i class='icon st-icon-eye notifiy-view'></i>
                                </a>
                                <!--/ko-->
                                <!--ko if: Module === 'Web Visit' -->
                                <a data-target="#bigmodal" data-toggle="modal" data-bind="attr:{href: '/getwebvisit?visitId=' + ModuleId }" title="View" class='mll'>
                                    <i class='icon st-icon-eye notifiy-view'></i>
                                </a>
                                <!--/ko-->
                                <!-- /ko-->
                            </span>
                            <span class="cd-date">
                                by <span class="green bold" data-bind="visible:UserName != null, text:UserName"></span>
                                <span data-bind="text:TimeLineTime"></span>
                            </span>
                        </div> <!-- cd-timeline-content -->
                    </div> <!-- cd-timeline-block -->
                </div>
            </div>
        </div>
    </div>
</section>
<div class="row">
    <div data-bind="visible:DisplayEndMessage">
        <div data-bind="text:'[|No more activities|]'" class="nomore-updates"></div>
    </div>
</div>

<script type="text/javascript">
    function ViewCampaign(e) {
        var moduleId = $(e).attr("data-id");
        window.open('/campaigndesignview?campaignId=' + moduleId, '_blank', 'left=500,top=100,width=920,height=720,toolbar=1,resizable=0');
    }
    $(document).ready(function () {
        eraseCookie("module");
        eraseCookie("period");
        createCookie("module", "", 1);
        createCookie("period", "", 1);

    });
</script>
